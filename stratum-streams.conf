# Nick's Mining Pool - Stratum Stream Configuration
# This file configures TCP forwarding for mining pool connections
# Backend Server: 172.16.111.20 (internal IP)
#
# INSTALLATION:
# 1. Copy this file to NPM container: docker cp stratum-streams.conf nginx-proxy-manager:/data/nginx/custom/
# 2. Include in nginx.conf: Add "include /data/nginx/custom/*.conf;" at the end
# 3. Test: docker exec nginx-proxy-manager nginx -t
# 4. Reload: docker exec nginx-proxy-manager nginx -s reload

# Bitcoin Cash (BCH) - Port 6002
stream {
    upstream bch_backend {
        # Backend mining pool server (internal IP)
        server 172.16.111.20:6002 max_fails=3 fail_timeout=30s;

        # Uncomment to add backup/load-balanced servers:
        # server 108.249.26.53:6002 backup;
    }

    server {
        listen 6002;
        proxy_pass bch_backend;

        # Connection timeouts (5 minutes default)
        proxy_timeout 300s;
        proxy_connect_timeout 10s;

        # Enable TCP keepalive to maintain connections
        proxy_socket_keepalive on;

        # Enable proxy protocol if backend needs client IP
        # proxy_protocol on;
    }
}

# Dogecoin (DOGE) - Port 6003
stream {
    upstream doge_backend {
        server 172.16.111.20:6003 max_fails=3 fail_timeout=30s;
    }

    server {
        listen 6003;
        proxy_pass doge_backend;
        proxy_timeout 300s;
        proxy_connect_timeout 10s;
        proxy_socket_keepalive on;
    }
}

# Bitcoin (BTC) - Port 6004
stream {
    upstream btc_backend {
        server 172.16.111.20:6004 max_fails=3 fail_timeout=30s;
    }

    server {
        listen 6004;
        proxy_pass btc_backend;
        proxy_timeout 300s;
        proxy_connect_timeout 10s;
        proxy_socket_keepalive on;
    }
}

# Bitcoin SV (BSV) - Port 6005
stream {
    upstream bsv_backend {
        server 172.16.111.20:6005 max_fails=3 fail_timeout=30s;
    }

    server {
        listen 6005;
        proxy_pass bsv_backend;
        proxy_timeout 300s;
        proxy_connect_timeout 10s;
        proxy_socket_keepalive on;
    }
}

# eCash (XEC) - Port 6007
stream {
    upstream ecash_backend {
        server 172.16.111.20:6007 max_fails=3 fail_timeout=30s;
    }

    server {
        listen 6007;
        proxy_pass ecash_backend;
        proxy_timeout 300s;
        proxy_connect_timeout 10s;
        proxy_socket_keepalive on;
    }
}
